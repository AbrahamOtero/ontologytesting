/*
 * AbrirProyectoJDialog.java
 *
 * Created on 24 de octubre de 2008, 12:52
 */

package code.google.com.p.ontologytesting.guiNew;

import code.google.com.p.ontologytesting.model.CollectionTest;
import code.google.com.p.ontologytesting.model.jenainterfaz.ExceptionReadOntology;
import code.google.com.p.ontologytesting.model.jenainterfaz.Jena;
import code.google.com.p.ontologytesting.model.jenainterfaz.JenaInterface;
import code.google.com.p.ontologytesting.persistence.SaveTest;
import java.beans.XMLDecoder;
import java.io.BufferedInputStream;
import java.io.File;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.JTextField;

/**
 *
 * @author  sara.garcia
 */
public class AbrirProyectoJDialog extends javax.swing.JDialog {
    private JFileChooser filechooser;
    private SaveTest saveTest = new SaveTest();
    private boolean proyectoCargado = false;
    private JenaInterface jenaInterface;
    private Jena jena;

    /** Creates new form AbrirProyectoJDialog */
    public AbrirProyectoJDialog(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        this.setTitle("Ubicación de la Ontología y el Namespace");
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        ubicacionFisicaTextField = new javax.swing.JTextField();
        examinarButton = new javax.swing.JButton();
        jLabel4 = new javax.swing.JLabel();
        namespaceTextField = new javax.swing.JTextField();
        cancelButton = new javax.swing.JButton();
        aceptarButton = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel1.setText("Datos del Proyecto");

        jLabel2.setText("Compruebe que los siguientes datos son correctos. En caso contrario, realize las modificaciones oportunas:");

        jLabel3.setText("Ubicación de la ontología con la que va a trabajar:");

        examinarButton.setText("Examinar");
        examinarButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                examinarButtonActionPerformed(evt);
            }
        });

        jLabel4.setText("Namespace de la ontología:");

        cancelButton.setText("Cancelar");
        cancelButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelButtonActionPerformed(evt);
            }
        });

        aceptarButton.setText("Aceptar");
        aceptarButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                aceptarButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 344, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(10, 10, 10)
                                .addComponent(jLabel2))))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(30, 30, 30)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 285, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel4, javax.swing.GroupLayout.PREFERRED_SIZE, 264, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(namespaceTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 353, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(aceptarButton)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(cancelButton))
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(ubicacionFisicaTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 427, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGap(18, 18, 18)
                                    .addComponent(examinarButton)))))
                    .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 566, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel2)
                .addGap(27, 27, 27)
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(ubicacionFisicaTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(examinarButton))
                .addGap(18, 18, 18)
                .addComponent(jLabel4)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(namespaceTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 51, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cancelButton)
                    .addComponent(aceptarButton))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

private void aceptarButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_aceptarButtonActionPerformed
// TODO add your handling code here:
    jenaInterface = new JenaInterface();                                              
    jena = jenaInterface.getJena();
    String ubicOnto = this.getUbicacionFisica();
    String namespaceOnto = this.getNamespaceText();
    if(ubicOnto.equals("") || namespaceOnto.equals("")){
        JOptionPane.showMessageDialog(this,"Todos los campos son obligatorios",                                                  
        "Warning Message",JOptionPane.WARNING_MESSAGE);  
    }else{
        if(!namespaceOnto.endsWith("#")){
            namespaceOnto = namespaceOnto.concat("#");
        }
        CollectionTest.getInstance().setOntology(ubicOnto);
        CollectionTest.getInstance().setNamespace(namespaceOnto);
         try{
            jena.addReasoner(ubicOnto);
            CollectionTest.getInstance().setNamespace(namespaceOnto);
            CollectionTest.getInstance().setOntology(ubicOnto);
            saveTest.actualizarListaDeInstancias();
            saveTest.actualizarListaDeTestsSimples(CollectionTest.getInstance().getScenariotest());
            saveTest.actualizarListaDeTestsSparql(CollectionTest.getInstance().getScenariotest());
            JOptionPane.showMessageDialog(this,"Proyecto cargado",                                                  
            "Confirm Message",JOptionPane.INFORMATION_MESSAGE); 
            this.setVisible(false);
            this.setProyectoCargado(true);
        }catch(ExceptionReadOntology ex){
            throw new ExceptionReadOntology("No se pudo crear el proyecto. La ontologia introducida no es valida.\n" +
                    "Introduzca una ontologia valida.");
        }
    }  
}//GEN-LAST:event_aceptarButtonActionPerformed

private void cancelButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelButtonActionPerformed
// TODO add your handling code here:
    this.setVisible(false);//GEN-LAST:event_cancelButtonActionPerformed
}

private void examinarButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_examinarButtonActionPerformed
// TODO add your handling code here:
    this.openFile(this.getUbicacionFisicaTextField());//GEN-LAST:event_examinarButtonActionPerformed
}

    private void openFile(JTextField textfield){
        String path="";
        filechooser = new JFileChooser("");
        filechooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
        int option = filechooser.showOpenDialog(this);
        if (option == JFileChooser.APPROVE_OPTION) {
          File selectedFile = filechooser.getSelectedFile();
          path = selectedFile.getAbsolutePath();
          textfield.setText(path);
        }
    }
    
    public String getNamespaceText() {
        return namespaceTextField.getText();
    }

    public void setNamespaceText(String namespaceTextField) {
        this.namespaceTextField.setText(namespaceTextField);
    }

    public String getUbicacionFisica() {
        return ubicacionFisicaTextField.getText();
    }
    
    public JTextField getUbicacionFisicaTextField() {
        return ubicacionFisicaTextField;
    }

    public void setUbicacionFisica(String ubicacionFisicaTextField) {
        this.ubicacionFisicaTextField.setText(ubicacionFisicaTextField);
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton aceptarButton;
    private javax.swing.JButton cancelButton;
    private javax.swing.JButton examinarButton;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JTextField namespaceTextField;
    private javax.swing.JTextField ubicacionFisicaTextField;
    // End of variables declaration//GEN-END:variables

    public boolean isProyectoCargado() {
        return proyectoCargado;
    }

    public void setProyectoCargado(boolean proyectoCargado) {
        this.proyectoCargado = proyectoCargado;
    }

}
